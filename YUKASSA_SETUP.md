# üí≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ÆKassa –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –ÆKassa
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://yookassa.ru/
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∫–∞–∫ –ø—Ä–æ–¥–∞–≤–µ—Ü
3. –ü—Ä–æ–π–¥–∏—Ç–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é
4. –°–æ–∑–¥–∞–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π API
1. –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"** ‚Üí **"API –∫–ª—é—á–∏"**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Shop ID** (ID –º–∞–≥–∞–∑–∏–Ω–∞)
   - **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á**

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

#### –û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª:
```env
# –ÆKassa –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï)
YUKASSA_SHOP_ID=your_real_shop_id
YUKASSA_SECRET_KEY=your_real_secret_key
YUKASSA_WEBHOOK_SECRET=your_webhook_secret

# –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...
DB_HOST=localhost
DB_PORT=5432
DB_NAME=krym_chitalka
DB_USER=postgres
DB_PASSWORD=your_password
JWT_SECRET=your-jwt-secret
PORT=3000
NODE_ENV=production
FRONTEND_URL=https://your-domain.com
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook

#### –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"** ‚Üí **"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"**
2. –î–æ–±–∞–≤—å—Ç–µ Webhook URL: `https://your-domain.com/api/payments/webhook`
3. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è:
   - ‚úÖ `payment.succeeded` (—É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞)
   - ‚úÖ `payment.canceled` (–æ—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–∞)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** webhook –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ .env

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ÆKassa:
```
–¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞: 5555 5555 5555 4477
–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 12/30 (–ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞)
CVC: 123 (–ª—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã)
–ò–º—è –¥–µ—Ä–∂–∞—Ç–µ–ª—è: CARD HOLDER
```

### –î—Ä—É–≥–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã:
- **–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞**: `4111 1111 1111 1111`
- **–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ**: `4000 0000 0000 0002`
- **3D Secure**: `4000 0000 0000 3220`

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
1. **HTTPS** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
2. **Webhook –ø–æ–¥–ø–∏—Å—å** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. **Rate limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø–∏—Å—å –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ webhook –ø–æ–¥–ø–∏—Å–∏:
```javascript
const crypto = require('crypto');

function verifyWebhookSignature(body, signature, secret) {
    const expectedSignature = crypto
        .createHmac('sha256', secret)
        .update(body)
        .digest('hex');
    
    return signature === expectedSignature;
}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–ª–∞—Ç–µ–∂–µ–π

### –õ–æ–≥–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
```javascript
// –í routes/payments.js
console.log('‚úÖ Payment created:', {
    paymentId: payment.id,
    amount: payment.amount.value,
    userId: req.user.id,
    timestamp: new Date().toISOString()
});
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ API
curl -X GET "https://api.yookassa.ru/v3/payments/{payment_id}" \
  -H "Authorization: Basic $(echo -n 'shop_id:secret_key' | base64)"
```

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. "Invalid authentication credentials"
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–≤–µ—Ä–Ω—ã–µ SHOP_ID –∏–ª–∏ SECRET_KEY
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa

### 2. "Webhook signature verification failed"
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–≤–µ—Ä–Ω—ã–π WEBHOOK_SECRET
**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á webhook –≤ .env

### 3. "Payment not found"
**–ü—Ä–∏—á–∏–Ω–∞**: –ü–ª–∞—Ç–µ–∂ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —É–¥–∞–ª–µ–Ω
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID –ø–ª–∞—Ç–µ–∂–∞ –∏ —Å—Ç–∞—Ç—É—Å –≤ –ÆKassa

### 4. "Amount too small"
**–ü—Ä–∏—á–∏–Ω–∞**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ 1 —Ä—É–±–ª—å
**–†–µ—à–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É >= 1.00

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø–ª–∞—Ç–µ–∂–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ö—É–ø–∏—Ç—å"
2. Frontend ‚Üí Backend: POST /api/payments/create
3. Backend ‚Üí –ÆKassa: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
4. –ÆKassa ‚Üí Frontend: redirect –Ω–∞ —Ñ–æ—Ä–º—É –æ–ø–ª–∞—Ç—ã
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
6. –ÆKassa ‚Üí Backend: webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
7. Backend: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ –ë–î
8. Frontend: redirect –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
9. Frontend: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
```

## üìà –ö–æ–º–∏—Å—Å–∏–∏ –ÆKassa

- **–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã**: 2.8% + 0‚ÇΩ
- **SBP (–°–ë–ü)**: 0.7% + 0‚ÇΩ
- **–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏**: 2.8% + 0‚ÇΩ
- **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–±–∞–Ω–∫–∏–Ω–≥**: 2.8% + 0‚ÇΩ

## üí° –°–æ–≤–µ—Ç—ã –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ö–µ—à–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π
2. **Retry –ª–æ–≥–∏–∫–∞**: –ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
3. **–¢–∞–π–º–∞—É—Ç—ã**: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Ä–∞–∑—É–º–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–ª–∞—Ç–µ–∂–µ–π

## üéØ –ü—Ä–æ–¥–∞–∫—à–Ω —á–µ–∫–ª–∏—Å—Ç

- [ ] ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –ÆKassa –≤ .env
- [ ] ‚úÖ HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] ‚úÖ Webhook URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] ‚úÖ –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞—â–∏—â–µ–Ω–∞
- [ ] ‚úÖ Rate limiting –≤–∫–ª—é—á–µ–Ω
- [ ] ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫
- [ ] ‚úÖ Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ staging

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ÆKassa**: https://yookassa.ru/developers/
- **–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞**: support@yoomoney.ru
- **Telegram**: @yookassa_support
