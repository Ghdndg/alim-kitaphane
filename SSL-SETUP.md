# üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è alimkitaphane.ru

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

**–í–ê–ñ–ù–û:** –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
1. –î–æ–º–µ–Ω `alimkitaphane.ru` –∏ `www.alimkitaphane.ru` —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞ (DNS A-–∑–∞–ø–∏—Å—å)
2. –ü–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ
3. Docker –∏ docker-compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

## –®–∞–≥ 1: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ email –≤ —Å–∫—Ä–∏–ø—Ç–µ

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `init-letsencrypt.sh` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ:
```bash
email="your-email@example.com" # –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ô EMAIL!
```

–Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π email:
```bash
email="admin@alimkitaphane.ru"
```

## –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x init-letsencrypt.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç
./init-letsencrypt.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–æ–∑–¥–∞—Å—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- –ó–∞–ø—É—Å—Ç–∏—Ç nginx
- –ü–æ–ª—É—á–∏—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç Let's Encrypt
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç nginx —Å –Ω–æ–≤—ã–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º

## –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞, –∑–∞–ø—É—Å—Ç–∏—Ç–µ certbot –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```bash
docker compose up -d certbot
```

Certbot –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤.

## –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
docker compose exec certbot certbot certificates

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ HTTPS –≤ –±—Ä–∞—É–∑–µ—Ä–µ
curl -I https://alimkitaphane.ru

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç —Å HTTP –Ω–∞ HTTPS
curl -I http://alimkitaphane.ru
```

## –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤—Ä—É—á–Ω—É—é
docker compose run --rm certbot renew

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å nginx –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
docker compose exec nginx nginx -s reload
```

## –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞, –≤ —Ñ–∞–π–ª–µ `init-letsencrypt.sh` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
```bash
staging=1
```

–≠—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä Let's Encrypt (–Ω–µ—Ç –ª–∏–º–∏—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤).

## –õ–∏–º–∏—Ç—ã Let's Encrypt

- **5 —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤** –Ω–∞ –æ–¥–∏–Ω –¥–æ–º–µ–Ω –≤ –Ω–µ–¥–µ–ª—é
- **50 —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤** —Å –æ–¥–Ω–æ–≥–æ IP –≤ –Ω–µ–¥–µ–ª—é
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–µ–π—Å—Ç–≤—É–µ—Ç **90 –¥–Ω–µ–π**

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞: "Connection refused"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 80 –æ—Ç–∫—Ä—ã—Ç: `sudo ufw allow 80`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ nginx –∑–∞–ø—É—â–µ–Ω: `docker compose ps`

### –û—à–∏–±–∫–∞: "Domain not found"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS: `nslookup alimkitaphane.ru`
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS (–¥–æ 24 —á–∞—Å–æ–≤)

### –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs certbot`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: `docker compose exec certbot certbot renew --dry-run`

